<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" th:href="@{/assets/css/style.css}">
  <script>
    function toggleButton() {
      var errorElement = document.getElementById("errorMsg");
      var dateStartValue = document.getElementById("dateStart").value;
      var dateEndValue = document.getElementById("dateEnd").value;

      var buttonElement = document.getElementById("makeReservation");

      // Convert the date strings to Date objects
      var currentDate = new Date();
      var startDate = new Date(dateStartValue);
      var endDate = new Date(dateEndValue);



      // Calculate the time difference in milliseconds
      var timeDiff = endDate.getTime() - startDate.getTime();

      // Convert the time difference to days
      var daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      console.log("daysDiff:", daysDiff);

      // Check if either date is empty or NaN
      if (dateStartValue === "" || isNaN(Date.parse(dateStartValue)) || dateEndValue === "" || isNaN(Date.parse(dateEndValue))) {
        buttonElement.disabled = true;
        buttonElement.style.cursor = "default";
        buttonElement.style.background = "rgb(121 189 127)";
        errorElement.textContent = "error: You should select start and end date";
        console.log("Invalid date(s)");
        return; // Exit the function early if invalid date(s) found
      }else if (startDate < currentDate ) {
        buttonElement.disabled = true;
        buttonElement.style.cursor = "default";
        buttonElement.style.background = "rgb(121 189 127)";
        errorElement.textContent = "error: Start date should be after current date";
        console.log("Invalid date(s)");
        return; // Exit the function early if invalid date(s) found
      } else if (daysDiff < 90) {
        buttonElement.disabled = true;
        buttonElement.style.cursor = "default";
        buttonElement.style.background = "rgb(121 189 127)";
        errorElement.textContent = "error: Reservation should be longer than 90 days";
        errorElement.removeAttribute("hidden");
      } else {
        buttonElement.disabled = false;
        buttonElement.style.cursor = "pointer";
        buttonElement.style.background = "rgb(41 147 50)";
        errorElement.setAttribute("hidden", "");
        var day = startDate.getDate();
        if(day < 10){
          day = '0' + day; // days are zero-based
        }
        var month = startDate.getMonth() + 1; // Months are zero-based
        if(month < 10){
          month = '0' + month;
        }
        var year = startDate.getFullYear();
        var formattedDate = day + "/" + month + "/" + year;
        var formattedDateForm = day + "-" + month + "-" + year;
        var startDateText = "Start Date: " + formattedDate;
        document.getElementById("confirm-start-date").textContent = startDateText;
        document.getElementById("form-start-date").value = formattedDateForm;
        var day = endDate.getDate();
        var month = endDate.getMonth() + 1; // Months are zero-based
        if(month < 10){
          month = '0' + month;
        }
        var year = endDate.getFullYear();
        var formattedDate = day + "/" + month + "/" + year;
        var formattedDateForm = day + "-" + month + "-" + year;
        var endDateText = "End Date: " + formattedDate;
        document.getElementById("confirm-end-date").textContent = endDateText;
        document.getElementById("form-end-date").value = formattedDateForm;
      }
    }
  </script>

  <script th:inline="javascript">
    // JavaScript code to handle the confirmation modal
    document.addEventListener("DOMContentLoaded", function() {
      var modal = document.getElementById("confirmationModal");
      var deleteButton = document.getElementById("cancelBtn");
      var confirmQuitButton = document.getElementById("confirmQuitButton");
      var cancelQuitButton = document.getElementById("cancelQuitButton");

      deleteButton.addEventListener("click", function() {
        modal.style.display = "block";
      });

      confirmQuitButton.addEventListener("click", function() {
        // User clicked OK, proceed with deletion
        document.getElementById("deleteForm").submit();
        modal.style.display = "none";
      });

      cancelQuitButton.addEventListener("click", function() {
        // User clicked Cancel, close the modal
        modal.style.display = "none";
      });

      window.addEventListener("click", function(event) {
        // Close the modal if the user clicks outside of it
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  </script>
  <script th:inline="javascript">
    // JavaScript code to handle the confirmation modal
    document.addEventListener("DOMContentLoaded", function() {
      var modal = document.getElementById("confirmationModalReserve");
      var makeReservation = document.getElementById("makeReservation");
      var confirmReserveButton = document.getElementById("confirmReserveButton");
      var cancelReserveButton = document.getElementById("cancelReserveButton");

      makeReservation.addEventListener("click", function() {
        modal.style.display = "block";
      });

      confirmReserveButton.addEventListener("click", function() {
        // User clicked OK, proceed with deletion
        document.getElementById("reserveForm").submit();
        modal.style.display = "none";
      });

      cancelReserveButton.addEventListener("click", function() {
        // User clicked Cancel, close the modal
        modal.style.display = "none";
      });

      window.addEventListener("click", function(event) {
        // Close the modal if the user clicks outside of it
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  </script>
</head>
<body>
<div>
  <div class="home-container">
    <header data-role="Header" class="header-details">
      <div class="header-container">
        <img alt="logo" src="https://studentdepot.pl/wp-content/themes/student/assets/img/logo-student-depot.svg" class="home-image"/>
      </div>
      <div class="home-nav">
        <nav class="navigation-links-nav navigation-links-root-class-name">
          <span class="navigation-links-text"><span>About</span></span>
          <span class="navigation-links-text"><span>Features</span></span>
          <span class="navigation-links-text"><span>Pricing</span></span>
          <span class="navigation-links-text"><span>Team</span></span>
          <span class="navigation-links-text"><span>Blog</span></span>
        </nav>
      </div>
    </header>
    <h1 class="home-text">Reservation Process</h1>
    <h1 class="home-text01" th:text="'Selected dorm: ' + ${room.getDormitory().getName()}"></h1>
    <div class="home-container-reserv">
      <div class="home-details">
        <div class="home-container-details">
          <span id="roomDetails" class="home-text02">Room details:</span>
          <span class="home-text03">
              <span id="roomNumber" th:text="'Room number: ' + ${room.getRoomNumber()}"></span>
              <br />
            </span>
          <span class="home-text03">
              <span id="roomPrice" th:text="'Room price: ' + ${room.getRoomPrice()}"> </span>
              <br />
            </span>
          <span class="home-text03">
              <span id="roomDescription" th:text="'Room description: ' + ${room.getRoomDescription()}"> </span>
              <br />
            </span>
          <span class="home-text03">
              <span id="roomSize" th:text="'Room size: ' + ${room.getRoomSize()}"></span>
              <br />
            </span>
        </div>
      </div>
      <div class="home-container-date">
        <div class="home-container-date2">
          <span class="home-text15">Select start date:</span>
          <input id="dateStart" type="date" name="dateStart" class="date-picker input" onchange="toggleButton()"/>
        </div>
        <div class="home-container-date2">
          <span class="home-text15">Select end date:</span>
          <input id="dateEnd" type="date" name="dateEnd" class="date-picker input" onchange="toggleButton()"/>
        </div>
      </div>
      <div style="align-self: center; margin-top: 60px;">
          <span id="errorMsg" style="color: red" text="">
          </span>
      </div>
      <div class="home-make-reserv">
        <form id="reserveForm" method="get" th:action="@{/reservation/process/complete}">
          <input type="hidden" id="roomId" name="roomId" th:value="${room.id}" />
          <input type="hidden" id="form-start-date" name="form-start-date"/>
          <input type="hidden" id="form-end-date" name="form-end-date" />
          <button id="makeReservation" type="button" class="button-make-reserv" disabled style="color: white; background: rgb(121 189 127); cursor: default">
            Make reservation
          </button>
        </form>
        <form id="deleteForm" method="get" th:action="@{/reservation/selectRoom}">
          <input type="hidden" name="dormSelect" th:value="${room.getDormitory().getId()}" />
          <button id="cancelBtn" type="button" class="button-cancel" >Cancel</button>
        </form>
      </div>
    </div>
    <div id="confirmationModal" class="modal">
      <div class="modal-content">
        <h2 style="flex-flow: column; display: flex; align-items: center; margin-top: 0;">Confirm cancel</h2>
        <p class="modal-text">Do you want to make changes or quit?</p>
        <div class="modal-buttons">
          <button id="cancelQuitButton" class="modal-btn" style="background-color: #7e84ff">Make changes</button>
          <button id="confirmQuitButton" class="modal-btn" style="background-color: #ff6767">Quit</button>
        </div>
      </div>
    </div>
    <div id="confirmationModalReserve" class="modal">
      <div class="modal-content">
        <h2 style="flex-flow: column; display: flex; align-items: center; margin-top: 0;">Confirm reservation</h2>
        <p th:text="'Dormitory: ' + ${room.getDormitory().getName()}"></p>
        <p th:text="'Room: ' + ${room.getRoomNumber()}"></p>
        <p id="confirm-start-date" text="Start Date: "></p>
        <p id="confirm-end-date" text="End Date: "></p>
        <div class="modal-buttons">
          <button id="confirmReserveButton" class="modal-btn" style="background-color: rgb(41 147 50)">Confirm</button>
          <button id="cancelReserveButton" class="modal-btn" style="background-color: #ff6767">Back</button>
        </div>
      </div>
    </div>
    <footer class="home-footer2">
      <div class="header-container">
        <img alt="logo" src="https://studentdepot.pl/wp-content/themes/student/assets/img/logo-student-depot.svg" class="home-image2"/>
      </div>
      <div class="home-links-container">
        <div class="home-container04">
          <div class="home-container05">
            <span class="home-text11">Product</span>
            <span class="home-text12">Features</span>
            <span class="home-text12">Pricing</span>
            <span class="home-text12">Tutorials</span>
            <span>Releases</span>
          </div>
          <div class="home-container06">
            <span class="home-text16">Company</span>
            <span class="home-text12">About</span>
            <span class="home-text12">Careers</span>
            <span class="home-text12">Contact</span>
            <span>Blog</span>
          </div>
        </div>
        <div class="home-container07">
          <div class="home-container08">
            <span class="home-text21">Support</span>
            <span class="home-text12">Terms of service</span>
            <span class="home-text12">Privacy Policy</span>
            <span class="home-text12">Legal</span>
            <span>Help center</span>
          </div>
          <div class="home-container09">
            <span class="home-text26">Resources</span>
            <span class="home-text12">Blog</span>
            <span class="home-text12">Pricing</span>
            <span class="home-text12">Service</span>
            <span>Product</span>
          </div>
        </div>
      </div>
    </footer>
  </div>
</div>

</body>
</html>